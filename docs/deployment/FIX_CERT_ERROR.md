# 修复证书错误（ERR_CERT_AUTHORITY_INVALID）

> **错误**：`net::ERR_CERT_AUTHORITY_INVALID` - 浏览器拒绝自签名证书

---

## 问题分析

**错误原因**：
- 使用的是自签名SSL证书
- 浏览器默认不信任自签名证书
- 需要用户手动接受证书警告

**错误信息**：
```
GET https://124.221.58.149/api/health net::ERR_CERT_AUTHORITY_INVALID
```

---

## 解决方案

### 方案1：在浏览器中接受证书（推荐，必须执行）

**这是必须的步骤，浏览器需要先信任证书才能访问**：

1. **在新标签页中访问**：
   ```
   https://124.221.58.149/api/health
   ```

2. **浏览器会显示"您的连接不是私密连接"警告**

3. **点击"高级"或"Advanced"**

4. **点击"继续前往 124.221.58.149（不安全）"或"Proceed to 124.221.58.149 (unsafe)"**

5. **应该看到JSON响应**：
   ```json
   {"status":"healthy","timestamp":"..."}
   ```

6. **现在证书已被浏览器接受，可以正常使用前端功能**

---

### 方案2：在浏览器中访问API文档页面

**同样需要接受证书**：

1. **访问**：
   ```
   https://124.221.58.149/docs
   ```

2. **接受证书警告**（同上）

3. **应该看到FastAPI文档页面**

---

## 验证步骤

### 步骤1：在浏览器中访问健康检查

**访问**：`https://124.221.58.149/api/health`

**操作**：
1. 浏览器显示证书警告
2. 点击"高级"
3. 点击"继续访问"
4. 应该看到JSON响应

---

### 步骤2：验证证书已被接受

**再次访问前端页面**：
- https://scarlettyellow.github.io/BeatSync/

**检查浏览器控制台**：
- 不应该再看到 `ERR_CERT_AUTHORITY_INVALID` 错误
- 健康检查应该成功

---

### 步骤3：测试上传功能

**现在应该可以正常上传视频**：
1. 上传dance视频
2. 上传bgm视频
3. 点击"开始处理"
4. 应该不再出现证书错误

---

## 为什么需要手动接受证书？

**技术原因**：
- 自签名证书不在浏览器的受信任证书列表中
- 浏览器无法自动验证证书的有效性
- 需要用户手动确认接受证书

**安全考虑**：
- 这是浏览器的安全机制
- 防止中间人攻击
- 自签名证书会显示警告，但功能正常

---

## 如果仍然无法访问

### 检查1：Nginx服务是否运行

```bash
sudo systemctl status nginx
```

**应该显示**：`active (running)`

---

### 检查2：HTTPS是否正常工作

**在服务器上测试**：
```bash
curl -k https://124.221.58.149/api/health
```

**预期输出**：`{"status":"healthy","timestamp":"..."}`

---

### 检查3：防火墙是否开放443端口

**在腾讯云控制台检查**：
- 确认443端口规则存在且已启用

---

### 检查4：清除浏览器缓存

**如果已接受证书但仍无法访问**：
1. 清除浏览器缓存
2. 或者使用隐私模式测试
3. 重新访问 `https://124.221.58.149/api/health` 并接受证书

---

## 长期解决方案（可选）

### 使用受信任的SSL证书

**如果要消除浏览器警告**：

1. **购买域名**（如：beatsync.example.com）

2. **配置DNS解析**：
   - 将域名解析到服务器IP：`124.221.58.149`

3. **使用Let's Encrypt免费证书**：
   ```bash
   sudo apt install -y certbot python3-certbot-nginx
   sudo certbot --nginx -d beatsync.example.com
   ```

4. **更新前端配置**：
   - 使用域名而不是IP地址
   - 浏览器会自动信任Let's Encrypt证书

**优点**：
- ✅ 消除浏览器警告
- ✅ 更专业
- ✅ 用户信任度更高

**缺点**：
- ❌ 需要购买域名
- ❌ 需要配置DNS

---

## 快速修复步骤

**立即执行**：

1. **在浏览器新标签页中访问**：
   ```
   https://124.221.58.149/api/health
   ```

2. **接受证书警告**：
   - 点击"高级"
   - 点击"继续访问"

3. **验证访问成功**：
   - 应该看到JSON响应

4. **返回前端页面**：
   - https://scarlettyellow.github.io/BeatSync/

5. **刷新页面**（`Ctrl+Shift+R` 或 `Cmd+Shift+R`）

6. **测试上传功能**

---

## 验证清单

- [ ] 在浏览器中访问 `https://124.221.58.149/api/health` 并接受证书
- [ ] 健康检查返回正常响应
- [ ] 前端页面不再显示证书错误
- [ ] 上传功能正常工作
- [ ] 处理功能正常工作

---

**最后更新**：2025-12-02

