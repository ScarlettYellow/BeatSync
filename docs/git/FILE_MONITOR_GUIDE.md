# 文件监控自动提示使用指南

## 功能说明

文件监控功能会**后台监控重要文件改动**，检测到改动时**自动提示你**，但**不会自动提交**，完全由你控制提交时机。

## 使用方法

### 启动监控

```bash
# 方式1：后台运行（推荐）
./start_monitor.sh

# 方式2：直接运行（前台，可以看到实时输出）
./AUTO_COMMIT_MONITOR.sh

# 方式3：后台运行（带参数）
./AUTO_COMMIT_MONITOR.sh --background
```

### 停止监控

```bash
./stop_monitor.sh
```

### 检查监控状态

```bash
./check_monitor.sh
```

## 工作流程

```
1. 启动监控
   ./start_monitor.sh
   
2. 你修改代码
   ... 编辑文件 ...
   
3. 监控检测到改动
   📝 [时间] 检测到文件改动
   💡 提示：可以运行 ./ac 提交
   
4. 你决定提交时
   ./ac
   
5. 自动提交并推送到GitHub ✅
```

## 监控配置

### 监控的文件

- `beatsync_fine_cut_modular.py`
- `beatsync_badcase_fix_trim_v2.py`
- `beatsync_parallel_processor.py`
- `beatsync_utils.py`
- `README.md`
- `PROJECT_STATUS.md`
- `EXCEPTION_HANDLING_GUIDE.md`

### 监控参数

- **检查间隔**: 2分钟（120秒）- 不会太频繁
- **稳定等待**: 3分钟（180秒）- 检测到改动后等待文件稳定
- **提示冷却**: 10分钟（避免频繁提示）
- **日志文件**: `.git_monitor.log`

**智能检测机制**：
1. 每2分钟检查一次文件状态
2. 检测到改动后，等待3分钟确保文件已保存完成
3. 文件稳定后，检查是否有Git改动
4. 如果有改动且不在冷却期，提示用户提交

### 自定义配置

编辑 `AUTO_COMMIT_MONITOR.sh`：

```bash
MONITOR_INTERVAL=30  # 检查间隔（秒）
IMPORTANT_FILES="..."  # 监控的文件列表
NOTIFY_COOLDOWN=300  # 提示冷却时间（秒）
```

## 使用场景

### 场景1：日常开发

```bash
# 1. 启动监控（一次）
./start_monitor.sh

# 2. 正常开发
# ... 修改代码 ...

# 3. 收到提示时，决定是否提交
./ac  # 如果觉得需要提交
```

### 场景2：长时间开发

```bash
# 早上启动监控
./start_monitor.sh

# 一天的工作...
# 监控会自动提示你提交

# 晚上停止监控（可选）
./stop_monitor.sh
```

## 提示示例

当检测到改动时，你会看到：

```
========================================
📝 [2024-11-17 14:30:25] 检测到文件改动
========================================

改动的文件：
    M beatsync_fine_cut_modular.py
    M README.md

💡 提示：可以运行以下命令提交：
   ./ac

========================================
```

## 注意事项

1. **不会自动提交**：监控只提示，不自动提交
2. **冷却机制**：5分钟内不重复提示，避免打扰
3. **后台运行**：监控在后台运行，不影响你的工作
4. **只监控重要文件**：不会监控所有文件，避免过多提示

## 故障排除

### 监控没有提示

```bash
# 1. 检查监控是否运行
./check_monitor.sh

# 2. 查看日志
tail -f .git_monitor.log

# 3. 重启监控
./stop_monitor.sh
./start_monitor.sh
```

### 监控占用资源

监控脚本很轻量，检查间隔30秒，几乎不占用资源。

### 停止监控

```bash
# 方式1：使用停止脚本
./stop_monitor.sh

# 方式2：直接kill进程
kill $(cat .git_monitor.pid)
```

## 与手动提交配合使用

**推荐工作流**：

1. **启动监控**（一次，长期运行）
   ```bash
   ./start_monitor.sh
   ```

2. **正常开发**
   - 修改代码
   - 监控自动提示

3. **收到提示后**
   - 决定是否提交
   - 运行 `./ac` 提交
   - 或继续开发

4. **重要改动**
   - 使用 `./git_commit_important.sh` 手动提交
   - 更详细的提交信息

## 总结

✅ **文件监控**：自动检测改动并提示  
✅ **手动提交**：你完全控制提交时机  
✅ **自动推送**：提交后自动推送到GitHub  
✅ **最佳组合**：监控提示 + 手动控制

