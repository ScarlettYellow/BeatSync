# 手机访问本地开发环境指南

> **目的**：说明如何在手机浏览器中访问本地开发环境

---

## 功能说明

**项目已支持手机访问本地服务**：
- 前端会自动检测访问来源
- 如果是局域网IP（手机访问），会自动使用局域网IP作为后端地址
- 无需手动配置

---

## 使用方法

### 步骤1：启动本地服务

**在您的电脑上执行**：

```bash
cd web_service
./start_local.sh
```

**服务启动后**：
- 后端服务：`http://localhost:8000`
- 前端页面：`http://localhost:8080`

---

### 步骤2：获取电脑的局域网IP地址

**在您的电脑上执行**：

**macOS/Linux**：
```bash
# 方法1：使用ifconfig
ifconfig | grep "inet " | grep -v 127.0.0.1

# 方法2：使用ip命令（Linux）
ip addr show | grep "inet " | grep -v 127.0.0.1

# 方法3：查看网络设置
# macOS: 系统设置 → 网络 → 查看IP地址
```

**Windows**：
```bash
ipconfig
# 查找"IPv4 地址"，通常是 192.168.x.x 或 10.x.x.x
```

**常见局域网IP格式**：
- `192.168.1.x`（最常见）
- `192.168.0.x`
- `10.0.0.x`
- `172.16.x.x` 到 `172.31.x.x`

**示例**：
- 如果您的电脑IP是 `192.168.1.100`
- 那么手机访问地址就是：`http://192.168.1.100:8080`

---

### 步骤3：确保手机和电脑在同一网络

**重要**：
- ✅ 手机和电脑必须连接到**同一个WiFi网络**
- ❌ 不能使用手机流量（4G/5G）
- ❌ 不能使用不同的WiFi网络

**检查方法**：
- 手机WiFi设置中查看连接的WiFi名称
- 电脑网络设置中查看连接的WiFi名称
- 确保两者相同

---

### 步骤4：在手机浏览器中访问

**在手机浏览器中输入**：

```
http://<电脑的局域网IP>:8080
```

**示例**：
- 如果电脑IP是 `192.168.1.100`
- 访问：`http://192.168.1.100:8080`

---

## 自动检测机制

### 前端自动检测逻辑

**前端代码会自动检测访问来源**：

```javascript
// 如果是本地开发环境（localhost或127.0.0.1）
if (hostname === 'localhost' || hostname === '127.0.0.1') {
    const backendUrl = 'http://localhost:8000';
    // 电脑浏览器访问
}

// 如果是局域网IP（手机访问）
const privateIpPattern = /^(192\.168\.|10\.|172\.(1[6-9]|2[0-9]|3[01])\.)/;
if (privateIpPattern.test(hostname)) {
    const backendUrl = `http://${hostname}:8000`;
    // 手机浏览器访问，自动使用手机访问的IP作为后端地址
}
```

**工作原理**：
- 手机访问 `http://192.168.1.100:8080`
- 前端检测到 `hostname` 是 `192.168.1.100`（局域网IP）
- 自动设置后端地址为 `http://192.168.1.100:8000`
- 无需手动配置

---

## 验证访问

### 检查浏览器控制台

**在手机浏览器中**：
1. 打开开发者工具（如果支持）
2. 查看Console标签
3. 应该看到：
   ```
   📱 本地开发环境检测（手机/局域网）
      访问地址: http://192.168.1.100:8080
      后端URL: http://192.168.1.100:8000
   ```

---

### 测试功能

**在手机浏览器中测试**：
1. 上传dance视频
2. 上传bgm视频
3. 点击"开始处理"
4. 查看处理状态
5. 下载处理结果

---

## 常见问题

### 问题1：无法访问

**可能原因**：
1. 手机和电脑不在同一WiFi网络
2. 电脑防火墙阻止了8000和8080端口
3. IP地址不正确

**解决方法**：

**检查网络**：
- 确保手机和电脑连接同一WiFi

**检查防火墙**（macOS）：
```bash
# 检查防火墙状态
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 如果防火墙开启，需要允许Python和Python3
# 系统设置 → 安全性与隐私 → 防火墙 → 允许Python
```

**检查防火墙**（Windows）：
- 控制面板 → Windows Defender防火墙
- 允许应用通过防火墙
- 允许Python和端口8000、8080

**检查IP地址**：
- 重新获取电脑的局域网IP
- 确保IP地址正确

---

### 问题2：可以访问前端，但无法上传

**可能原因**：
- 后端服务未启动
- 后端服务只监听localhost，未监听0.0.0.0

**解决方法**：

**检查后端服务**：
```bash
# 在电脑上检查
curl http://localhost:8000/api/health

# 在手机上测试（使用手机浏览器访问）
http://<电脑IP>:8000/api/health
```

**检查服务监听地址**：
- 确保后端服务监听 `0.0.0.0` 而不是 `127.0.0.1`
- `start_local.sh` 脚本已配置为 `--host 0.0.0.0`，应该没问题

---

### 问题3：IP地址经常变化

**可能原因**：
- DHCP动态分配IP
- 每次连接WiFi可能获得不同IP

**解决方法**：

**每次使用前重新获取IP**：
```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**或配置静态IP**（高级）：
- 在路由器中为电脑配置静态IP
- 或使用DHCP保留功能

---

## 快速开始

### 完整流程

1. **启动本地服务**
   ```bash
   cd web_service
   ./start_local.sh
   ```

2. **获取电脑IP**
   ```bash
   # macOS
   ifconfig | grep "inet " | grep -v 127.0.0.1
   
   # 或查看系统设置 → 网络 → WiFi → 详细信息 → IP地址
   ```

3. **确保手机和电脑在同一WiFi**

4. **在手机浏览器访问**
   ```
   http://<电脑IP>:8080
   ```

5. **测试功能**
   - 上传视频
   - 处理任务
   - 下载结果

---

## 网络架构

### 本地开发环境网络

```
手机（WiFi）                   电脑（WiFi）
┌──────────┐                  ┌──────────┐
│ 浏览器    │                  │ 本地服务  │
│          │                  │          │
│ 访问:     │  ───WiFi───>    │ 监听:    │
│ 192.168   │                  │ 0.0.0.0  │
│ .1.100    │                  │ :8000    │
│ :8080     │                  │ :8080    │
└──────────┘                  └──────────┘
      │                            │
      └──── 同一WiFi网络 ──────────┘
```

---

## 安全提醒

### 本地开发环境

**注意**：
- 本地服务只在局域网内可访问
- 不会暴露到公网
- 相对安全

**建议**：
- 只在开发时使用
- 不要在生产环境使用
- 使用完毕后停止服务

---

## 与线上服务的区别

### 本地服务（手机访问）

- **地址**：`http://192.168.1.100:8080`
- **后端**：`http://192.168.1.100:8000`
- **网络**：局域网（WiFi）
- **用途**：本地开发测试

### 线上服务（手机访问）

- **地址**：`https://scarlettyellow.github.io/BeatSync/`
- **后端**：`https://124.221.58.149`
- **网络**：互联网
- **用途**：生产环境

---

## 总结

**使用方法**：
1. 启动本地服务：`./start_local.sh`
2. 获取电脑IP地址
3. 确保手机和电脑在同一WiFi
4. 在手机浏览器访问：`http://<电脑IP>:8080`

**特点**：
- ✅ 自动检测局域网IP
- ✅ 自动配置后端地址
- ✅ 无需手动配置
- ✅ 方便手机测试

**注意事项**：
- 手机和电脑必须在同一WiFi网络
- 需要允许防火墙通过8000和8080端口
- IP地址可能会变化

---

**最后更新**：2025-12-02

