<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA支持 -->
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BeatSync">
    <!-- 防止浏览器缓存，确保总是加载最新版本 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>BeatSync 视频音轨自动对齐和替换</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <!-- 关键CSS内联 - 首屏渲染必备样式，消除FOUC -->
    <style>
/* 关键CSS - 首屏渲染必备样式（精简版，约3.5KB）*/
:root{--font-body-size:16px;--font-body-line:1.5;--font-secondary-size:14px;--font-secondary-line:1.4}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Helvetica','Arial',sans-serif;font-size:var(--font-body-size);line-height:var(--font-body-line);background-color:#F5F5F5;color:#333333;padding-top:constant(safe-area-inset-top);padding-top:env(safe-area-inset-top);padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom);padding-left:constant(safe-area-inset-left);padding-left:env(safe-area-inset-left);padding-right:constant(safe-area-inset-right);padding-right:env(safe-area-inset-right)}body.is-native{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none;touch-action:manipulation;overscroll-behavior:contain}.container{max-width:800px;margin:0 auto;padding:20px 16px;padding-top:max(96px,constant(safe-area-inset-top)+48px,env(safe-area-inset-top,0px)+48px);padding-bottom:max(20px,constant(safe-area-inset-bottom)+24px,env(safe-area-inset-bottom,0px)+24px);min-height:100vh;display:flex;flex-direction:column;gap:24px;position:relative}.container::after{content:'';display:block;height:10px;width:100%}.footer{text-align:center;padding:20px 16px;margin-top:auto}.footer-link{color:#2196F3;text-decoration:none;display:inline-block;font-size:12px}h1{text-align:center;font-size:28px;font-weight:bold;color:#333333;margin-bottom:24px;margin-top:8px;display:flex;flex-direction:column;gap:6px;align-items:center;line-height:1.2;padding-top:12px;position:relative}h1 .title-en{font-size:28px;font-weight:700;letter-spacing:-0.5px;color:#333333;line-height:1.2}h1 .title-cn{font-size:18px;font-weight:400;color:#666666;line-height:1.4;margin-top:4px}.upload-section{display:flex;flex-direction:column;gap:24px;margin-bottom:32px;flex:1}.upload-area{background:white;border:2px dashed #CCCCCC;border-radius:12px;padding:24px 16px;text-align:center;min-height:110px;display:flex;flex-direction:column;justify-content:center;align-items:center}.upload-area h2{font-size:18px;font-weight:600;color:#333333;margin-bottom:20px}.upload-btn{background-color:#007AFF;color:white;border:none;padding:12px 30px;font-size:16px;font-weight:600;border-radius:8px;cursor:pointer}.upload-hint{margin-top:15px;color:#666666;font-size:14px}.file-info{margin-top:14px;padding:12px 16px;background-color:#F0F0F0;border-radius:6px;display:flex;justify-content:center;align-items:center;text-align:center}.file-info span{font-size:14px;font-weight:400;color:#666666;line-height:1.4;max-width:100%;word-break:break-word;overflow-wrap:break-word;word-wrap:break-word}.action-section{margin-bottom:6px}.action-buttons{display:flex;justify-content:center;align-items:center;gap:12px;flex-wrap:wrap}.process-btn{background-color:#007AFF;color:white;border:none;padding:15px 50px;font-size:18px;font-weight:600;border-radius:8px;cursor:pointer;min-width:180px;width:60%;max-width:320px;height:50px}.process-btn:disabled{background-color:#CCCCCC;cursor:not-allowed}.reset-btn{background:transparent;color:#4A4A4A;border:none;padding:12px 14px;min-height:48px;height:48px;display:flex;align-items:center;justify-content:center;text-align:center;gap:8px;font-size:16px;line-height:1.2;font-weight:500;border-radius:8px;cursor:pointer;min-width:120px}.reset-btn::before{content:"";width:20px;height:20px;display:inline-block;background:center/contain no-repeat url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiPgo8cGF0aCBkPSJNMCAwIEMzLjc0MjcyNjUgMi44NTc3NDY4MyA1LjYyOTkxNDY0IDUuNTM1OTA5NDggNy4yNzM0Mzc1IDkuODk4NDM3NSBDNy43NDE3ODM1NSAxNC4xMDE3NDA4OSA3Ljc2MjExNTMzIDE4LjI4OTI3NzY5IDcuNzg1MTU2MjUgMjIuNTE1NjI1IEM3LjgwMzEwNzQ1IDIzLjcyNzkxNzc5IDcuODIxMDU4NjUgMjQuOTQwMjEwNTcgNy44Mzk1NTM4MyAyNi4xODkyMzk1IEM3Ljg5MzYxNDc0IDMwLjA1MDYwMzc2IDcuOTI3NTQwMiAzMy45MTE4NDQ2NiA3Ljk2MDkzNzUgMzcuNzczNDM3NSBDNy45OTQxMTQxNiA0MC4zOTU4NTA0OCA4LjAyODYwNDE0IDQzLjAxODI0NzE5IDguMDY0NDUzMTIgNDUuNjQwNjI1IEM4LjE0OTMzOTA4IDUyLjA1OTc4NTIzIDguMjE3NzA3MDcgNTguNDc4OTYxNSA4LjI3MzQzNzUgNjQuODk4NDM3NSBDOC45NDk5MDMyNiA2NC4yODMxOTIxNCA5LjYyNjM2OTAyIDYzLjY2Nzk0Njc4IDEwLjMyMzMzMzc0IDYzLjAzNDA1NzYyIEMxMS4yMTYxNDA0NCA2Mi4yMjU1MzM0NSAxMi4xMDg5NDcxNCA2MS40MTcwMDkyOCAxMy4wMjg4MDg1OSA2MC41ODM5ODQzOCBDMTMuOTExNTI0MzUgNTkuNzgzMTE0MDEgMTQuNzk0MjQwMTEgNTguOTgyMjQzNjUgMTUuNzAzNzA0ODMgNTguMTU3MTA0NDkgQzE4Ljk0NjI0NDczIDU1LjMwNzA3MzQ3IDIyLjMxNzMyMjA1IDUyLjgwMDQ5MDY3IDI1Ljg5ODQzNzUgNTAuMzk4NDM3NSBDMjYuNTc0NDcwMjEgNDkuOTQwNDk4MDUgMjcuMjUwNTAyOTMgNDkuNDgyNTU4NTkgMjcuOTQ3MDIxNDggNDkuMDEwNzQyMTkgQzM1LjE1MDk2OTMgNDQuMjAzMTEyNzggNDIuNjAwNTcxNzIgMzkuOTA4OTQ0MjggNTAuMjczNDM3NSAzNS44OTg0Mzc1IEM1MC44NjkxNDU1MSAzNS41ODQyMjg1MiA1MS40NjQ4NTM1MiAzNS4yNzAwMTk1MyA1Mi4wNzg2MTMyOCAzNC45NDYyODkwNiBDOTQuMzM3NDcwMjUgMTIuOTkwODk3MzQgMTQ3LjA5ODkxMjg5IDEwLjQxMjMxMzc1IDE5Mi4xODEzOTY0OCAyNC40ODE5MzM1OSBDMjI1LjIxNzc5MzY4IDM1LjI4NjMzMTgzIDI1Ny4yNTE0NjY0OCA1NC41NzU3NzMyMyAyNzkuMjczNDM3NSA4MS44OTg0Mzc1IEMyODAuMDc5MTAxNTYgODIuODY2NTIzNDQgMjgwLjg4NDc2NTYyIDgzLjgzNDYwOTM4IDI4MS43MTQ4NDM3NSA4NC44MzIwMzEyNSBDMjk5LjQwNzE1MjMgMTA2LjQwNDY1Mzk5IDMxMy4zNzYyNjk4NCAxMzEuNzgzMjE2NDkgMzIwLjI3MzQzNzUgMTU4Ljg5ODQzNzUgQzMyMC40Njg3MzA0NyAxNTkuNjU3NTM0MTggMzIwLjY2NDAyMzQ0IDE2MC40MTY2MzA4NiAzMjAuODY1MjM0MzggMTYxLjE5ODczMDQ3IEMzMzMuMzc4MDIxNTIgMjExLjI2MDQxMTcgMzI0Ljk4MjU2MTYgMjY0LjQ2NjUzMzY5IDI5OC44MzU5Mzc1IDMwOC42NDg0Mzc1IEMyODYuNzQzMTA3MTYgMzI4LjU5NjQzOTY5IDI3MC42ODU4MjE4IDM0Ni42MTc0OTYxMSAyNTIuMjczNDM3NSAzNjAuODk4NDM3NSBDMjUxLjc0MTg2MDM1IDM2MS4zMTcwNjA1NSAyNTEuMjEwMjgzMiAzNjEuNzM1NjgzNTkgMjUwLjY2MjU5NzY2IDM2Mi4xNjY5OTIxOSBDMjMzLjgwMTQ5MzY0IDM3NS4zNzIwMDE5NiAyMTUuMTc3NTIyNjkgMzg1LjEyMzg2MDkxIDE5NS4yNzM0Mzc1IDM5Mi44OTg0Mzc1IEMxOTQuNjE3NDY1ODIgMzkzLjE2MjM3MzA1IDE5My45NjE0OTQxNCAzOTMuNDI2MzA4NTkgMTkzLjI4NTY0NDUzIDM5My42OTgyNDIxOSBDMTY0LjQ3MDU5ODM2IDQwNS4xNTAwNzg3MiAxMjYuMzU2NzYyOTEgNDA1LjkxODM0MDcyIDk2LjI3MzQzNzUgMzk4Ljg5ODQzNzUgQzk1LjUxNTE0NjQ4IDM5OC43MzIxNDg0NCA5NC43NTY4NTU0NyAzOTguNTY1ODU5MzggOTMuOTc1NTg1OTQgMzk4LjM5NDUzMTI1IEM1Ni42Mzk4NTM0NiAzOTAuMDczNzMyNDMgMjQuODc5ODYxMzggMzcwLjkyOTQ5NDggLTIuNzI2NTYyNSAzNDQuODk4NDM3NSBDLTMuOTAyMTg3NSAzNDMuODA0MDIzNDQgLTMuOTAyMTg3NSAzNDMuODA0MDIzNDQgLTUuMTAxNTYyNSAzNDIuNjg3NSBDLTE0LjU2NTg2MjU3IDMzMy41OTUwMTE3MiAtMjkuNjIwMTY2MzYgMzE4LjU3NDQ0MTc5IC0zMS4wMjczNDM3NSAzMDQuOTk2MDkzNzUgQy0zMS4wNTQwNjA4NyAyOTguMDc2MzU4NDcgLTMwLjk4OTgwODQ4IDI5My4yMjUyNTMyMSAtMjUuOTIxODc1IDI4OC4wNTg1OTM3NSBDLTE5LjExODY2ODI1IDI4MS43ODE2NzI4IC0xNC4wNDU0NTExNSAyODAuNDU2NTgwNDUgLTQuODEyNSAyODAuNjY0MDYyNSBDMS4yNTE1MzkxMSAyODEuMTI0NjIyNDMgNC4wODkwOTAzNiAyODMuNTI2ODM2NjggOC4wODU5Mzc1IDI4Ny44MzU5Mzc1IEMxMS4wODU5NDIxNCAyOTEuMzQ3MzA2NTcgMTMuODUxNjA5NjUgMjk0Ljk5MDI5ODU0IDE2LjU4NTkzNzUgMjk4LjcxMDkzNzUgQzI0LjMxMTYxMzUzIDMwOS4xMjY2ODU5OCAzMi44Njk2NzEyOCAzMTguMDg4NDg2OTcgNDMuMjczNDM3NSAzMjUuODk4NDM3NSBDNDQuMjM1MDc4MTMgMzI2LjYyNTQ2ODc1IDQ1LjE5NjcxODc1IDMyNy4zNTI1IDQ2LjE4NzUgMzI4LjEwMTU2MjUgQzY5LjkyMzAxODgxIDM0NS4yODcyNzk5MiA5OC44NDEzNDgxNSAzNTUuODk1NTY2MzEgMTI4LjI3MzQzNzUgMzU2Ljg5ODQzNzUgQzEyOS4zODA3NDIxOSAzNTYuOTM4Mzk4NDQgMTMwLjQ4ODA0Njg4IDM1Ni45NzgzNTkzOCAxMzEuNjI4OTA2MjUgMzU3LjAxOTUzMTI1IEMxNzAuNjIwMDM2NzggMzU3LjcxODAwMjUgMjA3LjA3NzY4MTA4IDM0My45NTk4ODE4OCAyMzUuMjczNDM3NSAzMTYuODk4NDM3NSBDMjM2Ljk1OTU5NTMyIDMxNS4yNTE0OTI2NSAyMzguNjI5MTM5MjEgMzEzLjU4NzE3NjI5IDI0MC4yNzM0Mzc1IDMxMS44OTg0Mzc1IEMyNDEuMDQwOTUzMzcgMzExLjE2Mzc5MjcyIDI0MS4wNDA5NTMzNyAzMTEuMTYzNzkyNzIgMjQxLjgyMzk3NDYxIDMxMC40MTQzMDY2NCBDMjQ2LjEzNzQ1ODU4IDMwNi4yNDcxODcxOCAyNDkuNzM1OTAxMDUgMzAxLjg4NTU2MDggMjUzLjE0ODQzNzUgMjk2Ljk2MDkzNzUgQzI1My42NjMwOTU3IDI5Ni4yMjAwNDg4MyAyNTQuMTc3NzUzOTEgMjk1LjQ3OTE2MDE2IDI1NC43MDgwMDc4MSAyOTQuNzE1ODIwMzEgQzI3Ny41Mzk2ODE5NyAyNjEuMzY4MjU0MDIgMjg4LjA1MTQ1NTk4IDIyMS40NTY2MzQgMjgwLjgxNjg5NDUzIDE4MS4zNjg2NTIzNCBDMjczLjEwMjQ0MTAzIDE0Mi4xNTkwNzE2OSAyNTEuMDEwNjIxNzcgMTA4Ljk2MDY1NTI0IDIxOCA4Ni4zNDM3NSBDMjAzLjg0OTIxNjYgNzYuOTIyMzY2NDUgMTg4LjcyODk5NjMzIDY5Ljk4MTYzMTE4IDE3Mi40NjA5Mzc1IDY1LjA4NTkzNzUgQzE3MS44MTY0ODY4MiA2NC44OTA5NjY4IDE3MS4xNzIwMzYxMyA2NC42OTU5OTYwOSAxNzAuNTA4MDU2NjQgNjQuNDk1MTE3MTkgQzE1OS4yODU4NDA4OCA2MS4yOTQ4MTcyNiAxNDguMjE4MTU0ODEgNjAuNTIyMDU0MjUgMTM2LjU4NTkzNzUgNjAuNTg1OTM3NSBDMTM1Ljg3OTAwNzU3IDYwLjU4ODA5MjY1IDEzNS4xNzIwNzc2NCA2MC41OTAyNDc4IDEzNC40NDM3MjU1OSA2MC41OTI0NjgyNiBDMTIzLjc3NTA4MzQ3IDYwLjY0NDYzMjUgMTEzLjYzMDE4ODg5IDYxLjEyOTk0OTk2IDEwMy4yNzM0Mzc1IDYzLjg5ODQzNzUgQzEwMi4xMjQzOTk0MSA2NC4xODg0NzY1NiAxMDIuMTI0Mzk5NDEgNjQuMTg4NDc2NTYgMTAwLjk1MjE0ODQ0IDY0LjQ4NDM3NSBDODQuMzQxNjE3MTYgNjguNzQzODIyNjcgNjkuMjI3NjEyOTkgNzUuMzQyMzkwOTcgNTQuODk4NDM3NSA4NC43NzM0Mzc1IEM1NC4yMjIxNjMwOSA4NS4yMTgzMjUyIDUzLjU0NTg4ODY3IDg1LjY2MzIxMjg5IDUyLjg0OTEyMTA5IDg2LjEyMTU4MjAzIEM0NS45MTUzODE2MSA5MC44Njc2NDQ0MiAzOS42MjgyNzcyOSA5Ni40MTgxMDU3NCAzMy4yNzM0Mzc1IDEwMS44OTg0Mzc1IEMzNC40NjgyNzc1OSAxMDEuOTA3MjM2ODYgMzQuNDY4Mjc3NTkgMTAxLjkwNzIzNjg2IDM1LjY4NzI1NTg2IDEwMS45MTYyMTM5OSBDNDMuMjE5NjM3MTcgMTAxLjk3NDI4NDkzIDUwLjc1MTY5MzEyIDEwMi4wNDY0NDMxMyA1OC4yODM3ODI5NiAxMDIuMTM0MTUyNDEgQzYyLjE1NTQ3NTc3IDEwMi4xNzg3NDc3NSA2Ni4wMjcwNjU5OSAxMDIuMjE4MDI3MTEgNjkuODk4OTI1NzggMTAyLjI0NDg3MzA1IEM3My42NDAzNjE2OSAxMDIuMjcxMDE1MDMgNzcuMzgxNDAwNDcgMTAyLjMxMTQ5MjY5IDgxLjEyMjU4OTExIDEwMi4zNjE2MjM3NiBDODIuNTQ0OTYyOTEgMTAyLjM3ODIxOTI5IDgzLjk2NzQwNTI4IDEwMi4zODk3Nzg4OSA4NS4zODk4NjIwNiAxMDIuMzk2MDUxNDEgQzEwMi4wNzM2ODUyIDEwMi40NzcwMTc2NyAxMDIuMDczNjg1MiAxMDIuNDc3MDE3NjcgMTA4LjI5Njg3NSAxMDcuNTQ2ODc1IEMxMDguOTY1ODk4NDQgMTA4LjQwMTUyMzQ0IDEwOC45NjU4OTg0NCAxMDguNDAxNTIzNDQgMTA5LjY0ODQzNzUgMTA5LjI3MzQzNzUgQzExMC4zNDA2NjQwNiAxMTAuMTIwMzUxNTYgMTEwLjM0MDY2NDA2IDExMC4xMjAzNTE1NiAxMTEuMDQ2ODc1IDExMC45ODQzNzUgQzExNS4wNjc2OTYzMSAxMTcuMjU4OTA1MDcgMTE0Ljk3NDEyNjU1IDEyMy42NTUwNjQ0NCAxMTQuMjczNDM3NSAxMzAuODk4NDM3NSBDMTEyLjM5Nzc0MTc4IDEzNy41ODA2MDM1IDEwOC4yNzQ0MTg1MyAxNDEuNTExNjMxOTQgMTAyLjQwMjUzMTYyIDE0NS4wMTQ1MzU5IEM5OS44NjQyMzg3MyAxNDYuMDY4MzE3OTQgOTcuOTUzOTQwMjkgMTQ2LjE1NTQ4NTQ4IDk1LjIwNzkzMTUyIDE0Ni4xNjU4NjMwNCBDOTMuNjc1MDY3NTIgMTQ2LjE3ODY1Nzk5IDkzLjY3NTA2NzUyIDE0Ni4xNzg2NTc5OSA5Mi4xMTEyMzY1NyAxNDYuMTkxNzExNDMgQzkwLjk5NTgyNDg5IDE0Ni4xOTA4MDUwNSA4OS44ODA0MTMyMSAxNDYuMTg5ODk4NjggODguNzMxMjAxMTcgMTQ2LjE4ODk2NDg0IEM4Ny41NTE5MjU1MSAxNDYuMTk1NjgyMDcgODYuMzcyNjQ5ODQgMTQ2LjIwMjM5OTI5IDg1LjE1NzYzODU1IDE0Ni4yMDkzMjAwNyBDODEuOTI2MDYzMzQgMTQ2LjIyNTA2Mjg2IDc4LjY5NDY0MjQgMTQ2LjIzMTY3NTE1IDc1LjQ2MzAzMzQ0IDE0Ni4yMzI5NTE2NCBDNzMuNDQyMTA4OTEgMTQ2LjIzNDM3NDUxIDcxLjQyMTIxMTIxIDE0Ni4yMzg2NDY3IDY5LjQwMDI5MzM1IDE0Ni4yNDM5NDYwOCBDNjIuMzQ0MjM3NDYgMTQ2LjI2MjQ0NTIgNTUuMjg4MjU3MDcgMTQ2LjI3MDYxNzAzIDQ4LjIzMjE3NzczIDE0Ni4yNjkwNDI5NyBDNDEuNjY0NDQ5NjcgMTQ2LjI2Nzg0MjI4IDM1LjA5NzA1MDYxIDE0Ni4yODg5MzAyOCAyOC41Mjk0MDU3NyAxNDYuMzIwNTMwMyBDMjIuODgzMzg2OTEgMTQ2LjM0NjcyMzY0IDE3LjIzNzQ3NTI4IDE0Ni4zNTc0MDg5NiAxMS41OTEzOTYxNSAxNDYuMzU2MTMyMTUgQzguMjIyNTQyODkgMTQ2LjM1NTYyMzMxIDQuODUzOTgxOTUgMTQ2LjM2MTI2MjE2IDEuNDg1MTg5NDQgMTQ2LjM4MjQ4ODI1IEMtMi4yNzU1MzE4MSAxNDYuNDAyMDkxMDIgLTYuMDM1NDA3NjEgMTQ2LjM5NjMzMTM0IC05Ljc5NjE0MjU4IDE0Ni4zODQyNzczNCBDLTEwLjkwNTQ4MTU3IDE0Ni4zOTU1MTYzNiAtMTIuMDE0ODIwNTYgMTQ2LjQwNjc1NTM3IC0xMy4xNTc3NzU4OCAxNDYuNDE4MzM0OTYgQy0yMC40NDA2MzI3NyAxNDYuMzU5MDM5OTYgLTI0Ljg5MjIwNTUzIDE0NS4zMjkxNzc5NSAtMzAuNDMzNTkzNzUgMTQwLjM3MTA5Mzc1IEMtMzQuMTE5Njg2ODkgMTM1LjY2OTA0NTYxIC0zNS45NzA2NzczOSAxMzEuODI5OTIzMjEgLTM1Ljk5Mzk4ODA0IDEyNS44NDAwMjY4NiBDLTM2LjAwMjUxODAxIDEyNC44NDQ4NzU2NCAtMzYuMDExMDQ3OTcgMTIzLjg0OTcyNDQzIC0zNi4wMTk4MzY0MyAxMjIuODI0NDE3MTEgQy0zNi4wMTg5MzAwNSAxMjEuNzQzNzk1MDEgLTM2LjAxODAyMzY4IDEyMC42NjMxNzI5MSAtMzYuMDE3MDg5ODQgMTE5LjU0OTgwNDY5IEMtMzYuMDIzODA3MDcgMTE4LjQwMjg1NjI5IC0zNi4wMzA1MjQyOSAxMTcuMjU1OTA3OSAtMzYuMDM3NDQ1MDcgMTE2LjA3NDIwMzQ5IEMtMzYuMDU2NDQ3ODcgMTEyLjI4MTE5NTc4IC0zNi4wNjAzNTA2NCAxMDguNDg4MzY0ODYgLTM2LjA2MjUgMTA0LjY5NTMxMjUgQy0zNi4wNjg5MjY5NSAxMDIuMDU2MDA5MTkgLTM2LjA3NTY1NTI0IDk5LjQxNjcwNjU5IC0zNi4wODI2NzIxMiA5Ni43Nzc0MDQ3OSBDLTM2LjA5NTQ1Mzk4IDkxLjI0MjcwNDc4IC0zNi4wOTg0MzgwNiA4NS43MDgwNTI2MSAtMzYuMDk3MTY3OTcgODAuMTczMzM5ODQgQy0zNi4wOTU5Njc5NiA3My43OTI1MTA3OSAtMzYuMTE3MDQ0NDIgNjcuNDEyMDIwNzUgLTM2LjE0ODY1NTMgNjEuMDMxMjc3NDIgQy0zNi4xNzgwNTA5MSA1NC44NzY1ODYyNCAtMzYuMTg1MTQxNTQgNDguNzIyMDU2NTggLTM2LjE4Mzk0ODUyIDQyLjU2NzI5ODg5IEMtMzYuMTg2MzA1IDM5Ljk1NjY4NDAzIC0zNi4xOTUxMzExMiAzNy4zNDYwNjY1MyAtMzYuMjEwNjEzMjUgMzQuNzM1NDk2NTIgQy0zNi4yMzAyNjk0IDMxLjA3ODI2MzU5IC0zNi4yMjQ0MzUyMyAyNy40MjE4OTYxNCAtMzYuMjEyNDAyMzQgMjMuNzY0NjQ4NDQgQy0zNi4yMjM2NDEzNiAyMi42OTIxMjMyNiAtMzYuMjM0ODgwMzcgMjEuNjE5NTk4MDggLTM2LjI0NjQ1OTk2IDIwLjUxNDU3MjE0IEMtMzYuMTkxMjU2MDkgMTMuODkxNzMwNzIgLTM1LjIxMTQzNTUyIDguNjEzMDI4NzcgLTMxLjcyNjU2MjUgMi44OTg0Mzc1IEMtMjkuNTA3ODEyNSAwLjc0MjE4NzUgLTI5LjUwNzgxMjUgMC43NDIxODc1IC0yNy4yMjY1NjI1IC0wLjYwMTU2MjUgQy0yNi40NzM3NSAtMS4wNjU2MjUgLTI1LjcyMDkzNzUgLTEuNTI5Njg3NSAtMjQuOTQ1MzEyNSAtMi4wMDc4MTI1IEMtMTYuODA4Nzc2NTkgLTYuMDE4NzgwOTEgLTcuNTA4NTcxIC00Ljc5MDUzNjI1IDAgMCBaICIgZmlsbD0iIzRBNEE0QSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTIwLjcyNjU2MjUsNDYuMTAxNTYyNSkiLz4KPC9zdmc+Cg==");margin-right:4px}.download-btn{background-color:#4CAF50;color:white;border:none;padding:12px 24px;font-size:16px;border-radius:4px;cursor:pointer;transition:background-color 0.3s;display:flex;align-items:center;gap:8px;width:240px;justify-content:center;box-sizing:border-box;white-space:nowrap}.download-btn:hover:not(:disabled){background-color:#45a049}.download-btn:disabled{background-color:#cccccc;cursor:not-allowed;opacity:0.7}.download-btn .btn-status{font-size:18px;color:white;font-weight:bold}.download-btn .btn-text{font-weight:500}.upload-progress-container{margin-top:12px;max-width:500px;margin-left:auto;margin-right:auto;display:flex;flex-direction:column;gap:8px;align-items:flex-start}.upload-progress-bar{width:100%;height:10px;background:#EAEAEA;border-radius:999px;overflow:hidden}.upload-progress-fill{width:0%;height:100%;background:#4CAF50;border-radius:999px;transition:width 0.15s ease}.upload-progress-text{text-align:left;font-size:14px;color:#666666;font-weight:500}.video-result{background:white;border-radius:12px;padding:24px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.08)}.video-result h3{font-size:18px;font-weight:600;color:#333333;margin-bottom:15px}.status-section{text-align:center;margin-top:6px;margin-bottom:12px;min-height:24px}.status-text{font-size:var(--font-secondary-size);line-height:var(--font-secondary-line);color:#666666}@media (max-width:768px){body{padding-top:max(70px,constant(safe-area-inset-top)+50px,env(safe-area-inset-top,0px)+50px)!important}.container{padding:16px 12px;padding-top:max(24px,constant(safe-area-inset-top)+16px,env(safe-area-inset-top,0px)+16px);padding-bottom:max(24px,constant(safe-area-inset-bottom)+16px,env(safe-area-inset-bottom,0px)+16px);min-height:auto;gap:16px}}
    </style>
    <link rel="stylesheet" href="style.css?v=20251259">
    <!-- 内联样式：仅针对iOS App的UI布局修复（使用!important确保优先级） -->
    <style id="app-specific-styles">
        /* 此样式仅会在App端通过JavaScript应用 */
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <span class="title-en">BeatSync</span>
            <span class="title-cn">视频音轨自动对齐和替换</span>
        </h1>
        
        <!-- 上传区域 -->
        <div class="upload-section">
            <div class="upload-area" id="dance-upload">
                <h2>原始视频</h2>
                <input type="file" id="dance-file" accept="video/*" style="display: none;">
                <button class="upload-btn" onclick="document.getElementById('dance-file').click()">
                    选择文件
                </button>
                <p class="upload-hint">或拖拽文件到此处</p>
                <div class="file-info" id="dance-info" style="display: none;">
                    <span id="dance-fileinfo"></span>
                </div>
            </div>
            
            <div class="upload-area" id="bgm-upload">
                <h2>音源视频</h2>
                <input type="file" id="bgm-file" accept="video/*" style="display: none;">
                <button class="upload-btn" onclick="document.getElementById('bgm-file').click()">
                    选择文件
                </button>
                <p class="upload-hint">或拖拽文件到此处</p>
                <div class="file-info" id="bgm-info" style="display: none;">
                    <span id="bgm-fileinfo"></span>
                </div>
            </div>
        </div>
        
        <!-- 处理按钮 -->
        <div class="action-section">
            <div class="action-buttons">
                <button class="process-btn" id="process-btn" disabled>
                    开始处理
                </button>
                <button class="reset-btn" id="reset-btn" title="重置任务" aria-label="重置任务" style="display: none;">
                    重置
                </button>
            </div>
        </div>
        
        <!-- 状态显示 -->
        <div class="status-section">
            <p class="status-text" id="status-text"></p>
            <div class="status-skeleton" id="status-skeleton" style="display: none;">
                <div class="skeleton-line short"></div>
                <div class="skeleton-line long"></div>
            </div>
            <!-- 上传进度条 -->
            <div class="upload-progress-container" id="upload-progress-container" style="display: none;">
                <div class="upload-progress-bar">
                    <div class="upload-progress-fill" id="upload-progress-fill"></div>
                </div>
                <div class="upload-progress-text" id="upload-progress-text">0%</div>
            </div>
        </div>
        
        <!-- 预览和下载区域 -->
        <div class="download-section" id="download-section" style="display: none;">
            <!-- V2版本 -->
            <div class="video-result" id="v2-result" style="display: none;">
                <h3>V2版本结果</h3>
                <div class="video-preview-container">
                    <video id="v2-preview" controls preload="metadata" style="max-width: 100%; max-height: 400px; display: none;">
                        您的浏览器不支持视频播放
                    </video>
                </div>
                <div class="result-actions">
                    <button class="download-btn" id="download-v2-btn" disabled>
                        <span class="btn-status">⏳</span>
                        <span class="btn-text">下载视频</span>
                    </button>
                </div>
            </div>
            
            <!-- Modular版本 -->
            <div class="video-result" id="modular-result" style="display: none;">
                <h3>Modular版本结果</h3>
                <div class="video-preview-container">
                    <video id="modular-preview" controls preload="metadata" style="max-width: 100%; max-height: 400px; display: none;">
                        您的浏览器不支持视频播放
                    </video>
                </div>
                <div class="result-actions">
                    <button class="download-btn" id="download-modular-btn" disabled>
                        <span class="btn-status">⏳</span>
                        <span class="btn-text">下载视频</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 底部反馈建议 -->
        <footer class="footer">
            <a href="https://scarlett6900.feishu.cn/share/base/form/shrcnmX4M67ksh8bPQkrv5L4HAg" target="_blank" rel="noopener noreferrer" class="footer-link">反馈建议</a>
        </footer>
    </div>
    
    <!-- Service Worker注册 -->
    <script>
        // 注册Service Worker（强制清除缓存版本）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    // 先尝试注销所有现有的Service Worker（强制清除缓存）
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        console.log('[PWA] 注销旧Service Worker:', registration.scope);
                        await registration.unregister();
                    }
                    
                    // 清除所有缓存
                    if ('caches' in window) {
                        const cacheNames = await caches.keys();
                        await Promise.all(
                            cacheNames.map(cacheName => {
                                console.log('[PWA] 清除缓存:', cacheName);
                                return caches.delete(cacheName);
                            })
                        );
                    }
                    
                    // 注册新的Service Worker（带版本号，强制更新）
                    const registration = await navigator.serviceWorker.register('/sw.js?v=20251260');
                    console.log('[PWA] Service Worker注册成功:', registration.scope);
                    
                    // 立即激活新的Service Worker
                    if (registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    if (registration.installing) {
                        registration.installing.addEventListener('statechange', (e) => {
                            if (e.target.state === 'activated') {
                                console.log('[PWA] Service Worker已激活，清除旧缓存');
                                // 清除所有旧缓存（保留当前版本 beatsync-v1.3.31）
                                caches.keys().then(cacheNames => {
                                    cacheNames.forEach(cacheName => {
                                        if (cacheName !== 'beatsync-v1.3.31') {
                                            caches.delete(cacheName);
                                        }
                                    });
                                });
                                // 强制刷新页面以加载新资源
                                window.location.reload();
                            }
                        });
                    }
                    
                    // 检查更新
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('[PWA] 新版本已安装，强制刷新页面');
                                // 强制刷新以加载新版本
                                window.location.reload();
                            }
                        });
                    });
                } catch (error) {
                    console.warn('[PWA] Service Worker注册失败:', error);
                }
            });
        }
    </script>
    
    <!-- 添加版本号参数，每次更新时更改版本号，强制浏览器重新加载 -->
             <script src="script.js?v=20251260"></script>
</body>
</html>

