# CDN IP 访问限频配置指南

> **配置项**：IP 访问限频配置  
> **当前状态**：未开启  
> **建议**：可选配置，根据实际需求决定

---

## 配置说明

### 什么是 IP 访问限频？

IP 访问限频配置可以：
1. **限制单个 IP 的访问频率**：防止单个 IP 地址在短时间内发起过多请求
2. **防止 DDoS 攻击**：限制恶意 IP 的访问频率
3. **保护源站**：减少异常流量对源站的压力

---

## 是否需要配置？

### 推荐配置（如果符合以下情况）

✅ **建议开启，如果**：
1. **担心 DDoS 攻击**：希望防止恶意攻击
2. **源站资源有限**：希望保护源站不被异常流量压垮
3. **有异常流量**：已经遇到或担心遇到异常访问

### 可以跳过（如果符合以下情况）

⚠️ **可以跳过，如果**：
1. **业务量较小**：当前访问量不大，不担心攻击
2. **想先测试**：先测试 CDN 功能，后续再配置
3. **担心误封**：担心正常用户被误封

---

## 配置建议

### 当前默认值：100 QPS

**100 QPS 的含义**：
- 单个 IP 地址每秒最多可以发起 100 个请求
- 如果超过 100 QPS，CDN 会限制该 IP 的访问

### 对于 BeatSync 的业务场景分析

**BeatSync 的特点**：
- 主要提供视频文件下载服务
- 单个视频文件可能较大（几 MB 到几百 MB）
- 用户下载文件时，QPS 通常不高（主要是单个大文件下载）
- 但如果有恶意攻击，可能会发起大量请求

**建议阈值**：

#### 方案 1：保守配置（推荐）

```
IP访问阈值：100 QPS（保持默认）
```

**理由**：
- 正常用户下载视频文件时，QPS 通常很低（单个文件下载）
- 100 QPS 足够正常用户使用
- 可以有效防止恶意攻击

#### 方案 2：宽松配置

```
IP访问阈值：200-500 QPS
```

**理由**：
- 如果担心误封正常用户，可以设置更高的阈值
- 适合访问量较大的场景

#### 方案 3：严格配置

```
IP访问阈值：50 QPS
```

**理由**：
- 更严格地限制访问频率
- 适合对安全性要求很高的场景
- 但可能影响正常用户的使用

---

## 配置步骤

### 如果决定配置

1. **开启配置**：
   - 将"配置状态"开关**开启**（从灰色变为蓝色）

2. **设置阈值**：
   - **IP访问阈值**：建议保持 **100 QPS**（默认值）
   - 或根据实际需求调整

3. **点击"提交所有配置"**：
   - 配置将生效

---

## 注意事项

### ⚠️ 重要提示

1. **可能误封正常用户**：
   - 如果阈值设置过低，可能影响正常用户的使用
   - 建议从较高的阈值开始，根据实际情况调整

2. **大文件下载场景**：
   - BeatSync 是文件下载服务，用户下载大文件时 QPS 通常不高
   - 但如果用户同时下载多个文件，可能会触发限频

3. **动态调整**：
   - 可以根据实际使用情况调整阈值
   - 如果发现正常用户被误封，可以提高阈值
   - 如果发现异常流量，可以降低阈值

---

## 推荐配置

### 对于 BeatSync 的建议

**推荐配置**：
- **开启 IP 访问限频**：✅ 建议开启
- **IP访问阈值**：**100 QPS**（保持默认值）

**理由**：
1. ✅ 可以有效防止 DDoS 攻击
2. ✅ 100 QPS 对正常用户足够（视频下载 QPS 通常很低）
3. ✅ 可以保护源站资源
4. ✅ 如果发现误封，可以随时调整阈值

---

## 如果遇到问题

### 问题 1：正常用户被误封

**解决方法**：
1. 提高 IP 访问阈值（如改为 200 QPS）
2. 检查是否有其他限制规则冲突
3. 查看 CDN 日志，分析访问模式

### 问题 2：仍然受到攻击

**解决方法**：
1. 降低 IP 访问阈值（如改为 50 QPS）
2. 结合其他安全措施（如 WAF）
3. 联系 CDN 服务商寻求帮助

---

## 总结

### 配置建议

**推荐开启 IP 访问限频配置**，原因：
1. ✅ 可以有效防止 DDoS 攻击
2. ✅ 100 QPS 对正常用户足够
3. ✅ 可以保护源站资源
4. ✅ 配置简单，风险低

### 操作建议

1. **开启配置**：将"配置状态"开关开启
2. **保持默认值**：IP访问阈值保持 100 QPS
3. **监控使用**：观察是否有误封情况
4. **动态调整**：根据实际情况调整阈值

---

**最后更新**：2025-12-16
