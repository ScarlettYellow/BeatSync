# CDN 用量封顶配置指南

> **页面**：防止费用超额  
> **当前状态**：未配置（开关关闭）  
> **建议**：推荐配置，但非必须

---

## 配置说明

### 什么是用量封顶配置？

用量封顶配置可以：
1. **设置流量/带宽上限**：当 CDN 用量超过设定阈值时，自动触发封顶措施
2. **告警通知**：接近阈值时发送告警，提醒用户
3. **防止超额费用**：避免产生意外的高额账单

---

## 是否需要配置？

### 推荐配置（如果符合以下情况）

✅ **建议配置，如果**：
1. **购买了流量包**：你购买了 100GB 流量包，建议设置封顶阈值接近流量包大小
2. **担心费用**：希望控制 CDN 费用，避免意外超额
3. **业务量可预估**：可以预估每月/每日的流量使用量

### 可以跳过（如果符合以下情况）

⚠️ **可以跳过，如果**：
1. **流量包充足**：100GB 流量包足够使用，不担心超额
2. **费用预算充足**：不担心产生额外费用
3. **想先测试**：先测试 CDN 功能，后续再配置

---

## 推荐配置方案

### 方案 1：基于流量包配置（推荐）

如果你购买了 **100GB 流量包**，建议配置：

**规则 1：流量封顶**
- **统计类型**：流量
- **封顶类型**：返回404（或停止服务）
- **封顶阈值**：**90GB**（留 10GB 缓冲）
- **统计周期**：按天（或按月）
- **告警阈值**：**80GB**（提前告警）

**说明**：
- 当单日流量超过 90GB 时，CDN 停止服务或返回 404
- 当单日流量达到 80GB 时，发送告警通知
- 这样可以避免超出流量包后产生额外费用

### 方案 2：基于带宽配置

如果担心带宽峰值过高：

**规则 1：带宽封顶**
- **统计类型**：带宽
- **封顶类型**：返回404（或停止服务）
- **封顶阈值**：根据实际需求设置（如 100Mbps）
- **统计周期**：按天
- **告警阈值**：封顶阈值的 80%

---

## 配置步骤

### 1. 开启配置

1. 将"生效下方配置项"开关**开启**（从灰色变为蓝色）

### 2. 添加规则

1. 点击"新增规则"按钮
2. 填写规则信息：
   - **统计类型**：选择"流量"或"带宽"
   - **封顶类型**：选择"返回404"或"停止服务"
   - **封顶阈值**：设置阈值（如 90GB）
   - **统计周期**：选择"按天"或"按月"
   - **告警阈值**：设置告警阈值（如 80GB）
3. 点击"确定"

### 3. 配置告警通知

1. 在告警配置中设置接收方式（短信、邮件等）
2. 确保可以及时收到告警通知

---

## 注意事项

### ⚠️ 重要提示

1. **生效延迟**：配置生效存在约 10 分钟的延迟，期间产生的消耗会正常计费
2. **多条规则**：可以设置多条规则，任意一条触发阈值时都会生效
3. **封顶措施**：
   - **返回404**：用户访问时返回 404 错误（推荐，更安全）
   - **停止服务**：CDN 停止服务（可能影响用户体验）

### 💡 建议

- **封顶阈值**：设置为流量包的 90%（留 10% 缓冲）
- **告警阈值**：设置为封顶阈值的 80-90%（提前告警）
- **统计周期**：根据业务特点选择"按天"或"按月"

---

## 配置示例

### 示例 1：100GB 流量包配置

```
规则名称：流量封顶-100GB
统计类型：流量
封顶类型：返回404
封顶阈值：90GB
统计周期：按天
告警阈值：80GB
```

### 示例 2：按月统计

```
规则名称：月度流量封顶
统计类型：流量
封顶类型：返回404
封顶阈值：3000GB（假设每月预估）
统计周期：按月
告警阈值：2400GB
```

---

## 总结

### 配置建议

**推荐配置**，特别是如果你：
- ✅ 购买了流量包（100GB）
- ✅ 希望控制费用
- ✅ 可以预估流量使用量

**可以跳过**，如果：
- ⚠️ 流量包充足，不担心超额
- ⚠️ 想先测试功能，后续再配置

### 操作建议

1. **如果配置**：
   - 开启"生效下方配置项"开关
   - 添加流量封顶规则（建议 90GB，告警 80GB）
   - 配置告警通知方式

2. **如果跳过**：
   - 直接点击"下一步"继续配置
   - 后续可以在 CDN 控制台随时配置

---

**最后更新**：2025-12-16
