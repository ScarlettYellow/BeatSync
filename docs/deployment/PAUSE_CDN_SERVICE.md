# 暂停 CDN 服务指南

## 概述

本文档说明如何暂停腾讯云 CDN 服务。暂停后，域名将直接回源到服务器，不再通过 CDN 加速。

## 操作步骤

### 方法一：通过 CDN 控制台停用

1. **登录腾讯云控制台**
   - 访问：https://console.cloud.tencent.com/
   - 使用您的账号登录

2. **进入 CDN 控制台**
   - 在控制台首页，搜索"CDN"或"内容分发网络"
   - 点击进入"内容分发网络 CDN"控制台

3. **找到目标域名**
   - 在"域名管理"页面，找到 `beatsync.site` 加速域名
   - 确认域名状态为"已启动"或"部署中"

4. **停用 CDN 服务**
   - 点击域名右侧的"管理"按钮
   - 在域名详情页面，找到"基本配置"或"状态"选项
   - 点击"停用"或"关闭"按钮
   - 确认停用操作

   或者：
   - 在域名列表中，直接点击域名右侧的"停用"按钮
   - 确认停用操作

5. **等待生效**
   - 停用操作通常会在 **5-10 分钟内**生效
   - 停用后，域名状态会变为"已关闭"
   - 此时所有请求将直接回源到服务器 IP

### 方法二：通过 API 停用（可选）

如果需要通过 API 停用，可以使用腾讯云 API：

```bash
# 使用腾讯云 CLI（需要先安装和配置）
tccli cdn StopCdnDomain --Domain beatsync.site
```

## 验证停用状态

### 1. 检查 CDN 响应头

停用后，访问网站时不应再看到 CDN 相关的响应头：

```bash
curl -I https://beatsync.site/

# 停用前（有 CDN 标识）：
# X-Cache-Lookup: Cache Hit
# X-NWS-LOG-UUID: ...

# 停用后（无 CDN 标识）：
# 直接显示源站响应头
```

### 2. 检查域名状态

在 CDN 控制台的"域名管理"页面，确认 `beatsync.site` 的状态为"已关闭"。

### 3. 检查 DNS 解析

停用 CDN 后，DNS 解析仍然指向 CDN 节点，但 CDN 节点会将请求回源到服务器。这是正常行为。

## 注意事项

1. **停用后影响**
   - ✅ 所有请求直接回源到服务器，不再经过 CDN 缓存
   - ✅ 可以立即看到服务器的最新内容（无缓存延迟）
   - ⚠️ 下载速度可能变慢（取决于用户到服务器的网络质量）
   - ⚠️ 服务器带宽压力增加

2. **重新启用**
   - 如需重新启用 CDN，在域名列表中点击"启用"按钮即可
   - 重新启用后，CDN 配置保持不变

3. **费用**
   - 停用 CDN 后，不再产生 CDN 流量费用
   - 但服务器带宽费用可能会增加

## 当前状态

- **域名**：`beatsync.site`
- **停用原因**：App 端视频下载速度未明显提升
- **停用时间**：2025-12-20（已执行）
- **状态**：✅ 已停用

## 停用后验证步骤

### 1. 验证响应头（检查是否还有CDN标识）

在服务器上或本地执行：

```bash
curl -I https://beatsync.site/

# 停用后应该看到：
# - 不再有 X-Cache-Lookup 响应头
# - 不再有 X-NWS-LOG-UUID 响应头
# - 直接显示源站响应头（nginx/1.18.0）
```

### 2. 验证网站正常访问

访问 https://beatsync.site/ 确认：
- ✅ 网站可以正常打开
- ✅ 功能正常（上传、处理、下载）
- ✅ 响应速度正常

### 3. 验证DNS解析（可选）

虽然停用CDN后DNS仍然指向CDN节点，但CDN会自动回源。如需确认：

```bash
nslookup beatsync.site

# 可能仍然显示CDN的CNAME记录，这是正常的
# CDN停用后会自动将请求转发到源站
```

### 4. 验证App端访问

在iOS App中测试：
- ✅ App可以正常连接后端
- ✅ 视频下载功能正常
- ✅ 下载速度是否符合预期

## 相关文档

- [CDN 配置指南](./CDN_SETUP_GUIDE.md)
- [CDN API 缓存问题解决](./CDN_API_CACHE_ISSUE_RESOLVED.md)

---

**最后更新**：2025-12-20
