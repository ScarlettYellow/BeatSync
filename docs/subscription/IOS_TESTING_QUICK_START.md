# iOS App 订阅系统测试 - 快速开始

## 🚀 立即开始测试（无需 App Store Connect）

### 步骤 1：在 Xcode 中启用 StoreKit Testing

1. **打开项目**
   ```bash
   cd ios/App
   npx cap open ios
   ```

2. **配置 Scheme**
   - 在 Xcode 顶部，点击 **Scheme**（项目名称旁边，如 "App"）
   - 选择 **Edit Scheme...**（或按 `Cmd + <`）
   - 在左侧选择 **Run**
   - 切换到 **Options** 标签
   - 在 **StoreKit Configuration** 下拉菜单中选择 `Products.storekit`
   - 点击 **Close** 保存

3. **验证配置**
   - 确保 `Products.storekit` 文件在项目中可见
   - 文件位置：`ios/App/Products.storekit`

### 步骤 2：运行 App

1. **选择目标设备**
   - 在 Xcode 顶部选择模拟器或真机
   - 推荐：iOS 模拟器（iPhone 15 Pro）

2. **运行 App**
   - 点击 **Run** 按钮（或按 `Cmd + R`）
   - 等待 App 编译和启动

### 步骤 3：测试订阅功能

#### 3.1 打开订阅管理

1. 在 App 中找到"订阅管理"区域
2. 点击"查看订阅套餐"按钮
3. 应该显示订阅状态和产品列表

#### 3.2 测试产品列表

**预期结果**：
- 应该能看到 7 个产品：
  - ✅ 基础版月付（¥15.00）
  - ✅ 基础版年付（¥99.00）
  - ✅ 高级版月付（¥69.00）
  - ✅ 高级版年付（¥499.00）
  - ✅ 10次下载包（¥5.00）
  - ✅ 50次下载包（¥20.00）
  - ✅ 100次下载包（¥35.00）

**如果产品列表为空**：
- 检查 StoreKit Configuration 是否已选择
- 检查控制台是否有错误日志
- 重新运行 App

#### 3.3 测试购买流程

1. **选择产品**
   - 点击任意产品的"购买"按钮
   - 例如：点击"基础版月付"的"购买"按钮

2. **完成购买**
   - 应该弹出 StoreKit 购买界面（本地模拟）
   - 点击"购买"完成购买（无需真实支付）
   - 购买应该立即完成

3. **验证结果**
   - 订阅状态应该更新为"已订阅"
   - 下载次数应该增加
   - 控制台应该显示购买成功的日志

#### 3.4 测试订阅状态查询

1. **查看订阅状态**
   - 在订阅管理区域查看订阅状态卡片
   - 应该显示：
     - 订阅状态（已订阅/未订阅）
     - 下载次数信息
     - 免费试用信息

2. **验证信息**
   - 检查订阅类型是否正确
   - 检查下载次数是否正确
   - 检查到期时间是否正确

#### 3.5 测试恢复购买

1. **点击恢复购买**
   - 点击"恢复购买"按钮
   - 应该显示恢复结果

2. **验证结果**
   - 如果之前有购买，应该恢复成功
   - 订阅状态应该更新

### 步骤 4：检查控制台日志

在 Xcode 控制台中查看日志：

1. **打开控制台**
   - 在 Xcode 底部打开控制台窗口
   - 或按 `Cmd + Shift + Y`

2. **查看订阅相关日志**
   - 查找 `SubscriptionPlugin` 相关日志
   - 查找 `StoreKit` 相关日志
   - 检查是否有错误信息

3. **常见日志**
   ```
   [SubscriptionPlugin] 获取产品列表成功
   [SubscriptionPlugin] 购买成功: basic_monthly
   [SubscriptionPlugin] 订阅状态查询成功
   ```

---

## 测试检查清单

### ✅ 基础功能测试

- [ ] App 可以正常启动
- [ ] 订阅管理界面可以显示
- [ ] 产品列表可以正确加载（7 个产品）
- [ ] 产品信息正确显示（名称、价格、描述）
- [ ] 购买流程可以正常进行
- [ ] 购买后订阅状态正确更新
- [ ] 订阅状态查询功能正常
- [ ] 恢复购买功能可以正常工作
- [ ] 控制台没有错误日志

### ✅ UI 测试

- [ ] 订阅状态卡片显示正确
- [ ] 产品列表显示正确
- [ ] 购买按钮可以点击
- [ ] 状态更新及时
- [ ] 错误提示正确显示

---

## 常见问题

### Q1: 产品列表为空

**症状**：点击"查看订阅套餐"后，产品列表为空

**解决方法**：
1. 检查 Scheme 中是否选择了 `Products.storekit`
2. 重新运行 App
3. 检查控制台是否有错误日志
4. 验证 `Products.storekit` 文件是否在项目中

### Q2: 购买失败

**症状**：点击购买后，显示购买失败

**解决方法**：
1. 检查控制台错误日志
2. 验证产品 ID 是否正确
3. 检查 SubscriptionPlugin 是否正确注册
4. 重新运行 App

### Q3: 订阅状态不更新

**症状**：购买成功后，订阅状态没有更新

**解决方法**：
1. 检查前端代码是否正确调用 API
2. 检查控制台日志
3. 手动刷新订阅状态
4. 检查后端服务是否运行（如果需要）

---

## 下一步

### 本地测试完成后

1. ✅ 验证基本功能正常
2. ✅ 修复发现的问题
3. ⏳ 等待 Apple Developer Program 审核通过
4. ⏳ 进行沙盒测试（完整功能测试）

---

**开始测试吧！** 🚀
